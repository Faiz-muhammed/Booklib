 <section class="checkout_area section_gap">
      <div class="container">

        {{!-- <div class="cupon_area">
          <div class="check_title">
            <h2>
              Have a coupon?
             
            </h2> 
          </div>
          <input type="text" placeholder="Enter coupon code" />
          <a class="tp_btn" href="#">Apply Coupon</a>
        </div> --}}
        <div class="billing_details">
          <div class="row">
            <div class="col-lg-8">
               {{#if addressExist}}
              <div class="alert alert-danger" role="alert">
                This address already Exists!
             </div>
               {{/if}}
              <h3>Billing Details</h3>
             
              <div class="col-md-12 ">
                <div class="row">
                  <h6 class="col-md-6">Saved addresses</h6>
                  {{!-- <div class="col-md-6 text-right"><button type="submit" class="btn  btn-primary btn-sm  ">ADD NEW</button></div> --}}
                 <div class="col-md-6 text-right"><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">ADD NEW</button></div>
                </div>
                <br>
                 
                 {{#each userDet}}
                 <div class="card">
                    <div class="card-header">
                      <div class="form-check">
                          <input class="form-check-input" onclick="shippingAddress('{{this.address.addressId}}')" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                          <label class="form-check-label" for="flexRadioDefault1">
                            Select address
                          </label>
                        </div>
                    </div>
                   
                    <div class="card-body">
                      <p class="card-text m-0">{{this.address.name}}</p>
                      <p class="card-title m-0">{{this.address.house}},{{this.address.street}}</p>
                      <p class="card-text m-0">{{this.address.district}}</p>
                      <p class="card-text m-0">{{this.address.state}}</p>
                      <p class="card-text m-0">{{this.address.phoneNumber}}</p>
                      
                    </div>
                  </div>
                  <br>
                  {{/each}}
                  

                </div>
                
                
             
            </div>
            <div class="col-lg-4">
              <div class="order_box">
                <h2>Your Order</h2>
                <ul class="list">
                  <li>
                    <a  class="text-dark"
                      >Product
                      <span>Total</span>
                    </a>
                  </li>
                  {{!-- {{#each buynowProduct}} --}}
                  <li>
                    <a>
                      {{buynowProduct.product_name}}
                     
                      <span class="middle">x 1</span>
                      <span class="last">₹{{buynowProduct.price}}</span>
                    </a>
                  </li>
                  {{!-- {{/each}} --}}
                  
                </ul>
                <ul class="list list_2">
                  <li>
                    <a 
                      >Subtotal
                      <span>₹{{total}}.00</span>
                    </a>
                  </li>
                  <li>
                    <a 
                      >Shipping
                      <span>Free</span>
                    </a>
                  </li>
                   <p id="couponNotexist"></p>
                   <li>
                    <a>
                     <input id="couponCode" type="text" style="text-transform: uppercase;" class="border-0" placeholder="Enter your code">
                      <span onclick="couponApply()" class="btn btn-dark text-light">Apply</span>
                    </a>
                  </li>
                   {{!-- <p id="discount"></p> --}}
                    <li>
                    <a 
                      >Discount
                      <span><span id="discount"></span></span>
                    </a>
                  </li>
                  <li>
                    <a 
                      >Total
                       <span>₹<span id="total">{{total}}</span></span>
                    </a>
                  </li>
                </ul>
                <div class="payment_item">
                  <div class="radion_btn">
                    <input type="radio" onclick="paymentMethod('Cod')" id="f-option5" name="selector" />
                    <label for="f-option5">Cash on delivery(COD)</label>
                    <div class="check"></div>
                  </div>

                </div>
                <div class="payment_item active">
                  <div class="radion_btn">
                    <input type="radio" onclick="paymentMethod('Razorpay')" id="f-option7" name="selector" />
                    <label for="f-option7">Razorpay </label>
                    <img src="img/product/single-product/card.jpg" alt="" />
                    <div class="check"></div>
                  </div>
                  
                </div>

                 <div class="payment_item active">
                  <div class="radion_btn">
                    <input type="radio" onclick="paymentMethod('Paypal')" id="f-option6" name="selector" />
                    <label for="f-option6">Paypal </label>
                    <img src="img/product/single-product/card.jpg" alt="" />
                    <div class="check"></div>
                  </div>
                  
                </div>
               
                <a class="main_btn" onclick="placeOrder('{{currentUser}}')">Proceed to Pay</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!--================End Checkout Area =================-->
<!-- Button trigger modal -->


<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">ADD NEW ADDRESS</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        {{!-- <div class="d-flex justify-content-center">
          {{#if addressExist}}
          <p class="text-danger">This address already exist</p>
          {{/if}}
        </div> --}}
       
      </div>
      <div class="card-body">
        <form action="/addbuyAddresscheckout" method="post">
          <!-- 2 column grid layout with text inputs for the first and last names -->
           <div class="form-outline mb-4">
            <input type="text" id="form7Example3" name="name" class="form-control" />
            <label class="form-label"  for="form7Example3">Full name</label>
          </div>
            

          <!-- Text input -->
          <div class="form-outline mb-4">
            <input type="text" id="form7Example3" name="house" class="form-control" />
            <label class="form-label" for="form7Example3">House/Building number</label>
          </div>

          <!-- Text input -->
          <div class="form-outline mb-4">
            <input type="text" id="form7Example4" name="street" class="form-control" />
            <label class="form-label" for="form7Example4">Street/locality</label>
          </div>

          <div class="form-outline mb-4">
            <input type="text" id="form7Example4" name="district" class="form-control" />
            <label class="form-label" for="form7Example4">District/City</label>
          </div>

           <div class="form-outline mb-4">
            <input type="text" id="form7Example4" name="state" class="form-control" />
            <label class="form-label" for="form7Example4">State</label>
          </div>

          <!-- Email input -->
          

          <!-- Number input -->
          <div class="form-outline mb-4">
            <input type="number" id="form7Example6" name="phoneNumber" class="form-control" />
            <label class="form-label" for="form7Example6">Phone</label>
          </div>

          

          <!-- Checkbox -->
          {{!-- <div class="form-check d-flex justify-content-center mb-2">
           <input class="btn btn-primary" type="submit" value="Submit">
           
          </div> --}}
       
      </div>
      <div class="modal-footer">
        {{!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> --}}
        <button type="submit" class="btn btn-primary">Submit</button>
      </div>
    </div>
     </form>
  </div>
</div>
    <!--================ start footer Area  =================-->
    <footer class="footer-area section_gap">
      <div class="container">
        <div class="row">
          <div class="col-lg-2 col-md-6 single-footer-widget">
            <h4>Top Products</h4>
            <ul>
              <li><a href="#">Managed Website</a></li>
              <li><a href="#">Manage Reputation</a></li>
              <li><a href="#">Power Tools</a></li>
              <li><a href="#">Marketing Service</a></li>
            </ul>
          </div>
          <div class="col-lg-2 col-md-6 single-footer-widget">
            <h4>Quick Links</h4>
            <ul>
              <li><a href="#">Jobs</a></li>
              <li><a href="#">Brand Assets</a></li>
              <li><a href="#">Investor Relations</a></li>
              <li><a href="#">Terms of Service</a></li>
            </ul>
          </div>
          <div class="col-lg-2 col-md-6 single-footer-widget">
            <h4>Features</h4>
            <ul>
              <li><a href="#">Jobs</a></li>
              <li><a href="#">Brand Assets</a></li>
              <li><a href="#">Investor Relations</a></li>
              <li><a href="#">Terms of Service</a></li>
            </ul>
          </div>
          <div class="col-lg-2 col-md-6 single-footer-widget">
            <h4>Resources</h4>
            <ul>
              <li><a href="#">Guides</a></li>
              <li><a href="#">Research</a></li>
              <li><a href="#">Experts</a></li>
              <li><a href="#">Agencies</a></li>
            </ul>
          </div>
          <div class="col-lg-4 col-md-6 single-footer-widget">
            <h4>Newsletter</h4>
            <p>You can trust us. we only send promo offers,</p>
            <div class="form-wrap" id="mc_embed_signup">
              <form target="_blank" action=""
                method="get" class="form-inline">
                <input class="form-control" name="EMAIL" placeholder="Your Email Address" onfocus="this.placeholder = ''"
                  onblur="this.placeholder = 'Your Email Address '" required="" type="email">
                <button class="click-btn btn btn-default">Subscribe</button>
                <div style="position: absolute; left: -5000px;">
                  <input name="b_36c4fd991d266f23781ded980_aefe40901a" tabindex="-1" value="" type="text">
                </div>
  
                <div class="info"></div>
              </form>
            </div>
          </div>
        </div>
        <div class="footer-bottom row align-items-center">
          <p class="footer-text m-0 col-lg-8 col-md-12"><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
          <div class="col-lg-4 col-md-12 footer-social">
            <a href="#"><i class="fa fa-facebook"></i></a>
            <a href="#"><i class="fa fa-twitter"></i></a>
            <a href="#"><i class="fa fa-dribbble"></i></a>
            <a href="#"><i class="fa fa-behance"></i></a>
          </div>
        </div>
      </div>
    </footer>
    <!--================ End footer Area  =================-->

    <!-- Optional JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/popper.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/stellar.js"></script>
    <script src="vendors/lightbox/simpleLightbox.min.js"></script>
    <script src="vendors/nice-select/js/jquery.nice-select.min.js"></script>
    <script src="vendors/isotope/imagesloaded.pkgd.min.js"></script>
    <script src="vendors/isotope/isotope-min.js"></script>
    <script src="vendors/owl-carousel/owl.carousel.min.js"></script>
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="js/mail-script.js"></script>
    <script src="vendors/jquery-ui/jquery-ui.js"></script>
    <script src="vendors/counter-up/jquery.waypoints.min.js"></script>
    <script src="vendors/counter-up/jquery.counterup.js"></script>
    <script src="js/theme.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        let orderedAddress;
        let paymentType;
        let proId='{{buynowProduct._id}}'
        let discounted=false;
        let code;
        let grandtotal={{total}}
        
        
       
    function paymentMethod(payMethod){

      paymentType=payMethod;

    }
  
    function shippingAddress(addressId){

      orderedAddress=addressId;
    } 
    
    function placeOrder(userId){
     
     if(typeof orderedAddress==='undefined'||typeof paymentType==='undefined'){

         Swal.fire(
          
         'Please choose an address and payment method',
         
)

     }
    
       else{
        $.ajax({
         url:'/placeOrderBuynow?deliveryAddress='+orderedAddress+"&paymentMethod="+paymentType+"&userId="+userId+"&buynow="+true+"&proId="+proId+"&couponTotal="+discounted+"&coupon="+code,
         method:'get',
         success:(response)=>{

           if(response.codSuccess){
             console.log(response);
             location.replace('/ordersuccess')
           }
           else if(response.data){
              console.log(response);
             location.href=response.url;
           }
           else{
              razorpayPayment(response) 
           }
         }
       })
       }

       
     }
     function razorpayPayment(order){
       var options = {
    "key": "rzp_test_cNsSkfLEAMFiuf", // Enter the Key ID generated from the Dashboard
    "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
    "currency": "INR",
    "name": "BOOKLIB",
    "description": "Test Transaction",
    "image": "https://example.com/your_logo",
    "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
    "handler": function (response){
        

        verifyPayment(response,order)
    },
    "prefill": {
        "name": "Gaurav Kumar",
        "email": "gaurav.kumar@example.com",
        "contact": "9999999999"
    },
    "notes": {
        "address": "Razorpay Corporate Office"
    },
    "theme": {
        "color": "#3399cc"
    }
};
     var rzp1 = new Razorpay(options);
     rzp1.open();
     }
     function verifyPayment(payment,order){
       $.ajax({
         url:'/verify-payment',
         data:{
           payment,
           order
         },
         method:'post',
         success:(response)=>{
           if(response.status){
             location.href='/ordersuccess'
           }
           else{
             Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: 'Payment Failed!',
                footer: '<a href="">Why do I have this issue?</a>'
              })
           }
         }

       })
     }
    
    {{!-- coupon call --}}

    function couponApply(){
     
       code=document.getElementById('couponCode').value
      {{!-- var subtotal= --}}

      code=code.toUpperCase()
      

       $.ajax({
         url:'/CheckCoupon',
         data:{code},
         method:'post',
         success:(response)=>{
           if(response.justradeemed){
             document.getElementById('couponNotexist').innerHTML="Coupon applied succesfully.";
             document.getElementById('couponNotexist').style.color="green";
            var total=document.getElementById('total').innerHTML
            
             var couponTotal=grandtotal*response.justradeemed.Discount/100;
             discounted=grandtotal-couponTotal;
            document.getElementById('total').innerHTML=discounted;
            document.getElementById('discount').innerHTML=couponTotal;
             
           }
           else{
             if(response.radeemed)
             {
               document.getElementById('couponNotexist').innerHTML="Coupon Radeemed already."
               document.getElementById('couponNotexist').style.color="red";
             }
             else{
             document.getElementById('couponNotexist').innerHTML= "Coupon does not exist!";
             document.getElementById('couponNotexist').style.color="red";
             }
           }
         }
         })
    }
    </script>